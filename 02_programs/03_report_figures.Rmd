---
title: "DescripStat_Arrests"
author: "Adelaide Currin"
date: "2022-11-18"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(sf)
library(lubridate)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#download data
ar_oz <- read_csv("../00_data/ar_oz.csv")

cp_oz <- read_csv("../00_data/cp_oz.csv")

st_oz <- read_csv("../00_data/st_oz.csv")
st_oz %>% 
  head()
```

```{r}
#date
ar_oz <- ar_oz %>%
  mutate(arrest_month_yr = as.Date(str_c(month(arrest_date), 1, year(arrest_date), sep="-"), "%m-%d-%Y")) %>% 
  mutate(year = year(arrest_month_yr))

cp_oz <- cp_oz %>% 
  mutate(cp_month_yr = as.Date(str_c(month(cmplnt_fr_dt), 1, year(cmplnt_fr_dt), sep="-"), "%m-%d-%Y")) %>% 
  mutate(year = year(cp_month_yr))

st_oz <- st_oz %>% 
  mutate(st_month_yr = as.Date(str_c(month(occur_date), 1, year(occur_date), sep="-"), "%m-%d-%Y")) %>% 
  mutate(year = year(st_month_yr))
  

# Borough pop from 2016-2020 ACS
boro.totals <- data.frame(table(ar_oz$arrest_boro))
boropops <- c(1427056, 2576771, 1629153, 2270976, 475596)
boro.totals[,"BoroPop"] <- (boropops)
names(boro.totals)[1] <- "arrest_boro"
boro.totals <- boro.totals %>% select(arrest_boro, BoroPop)

ar_oz <- left_join(ar_oz, boro.totals, by = "arrest_boro") %>% 
  mutate(BoroPop = as.numeric(BoroPop))
```

```{r}
ar_oz %>%
   nrow()
summary(ar_oz)

#arrests per day
ar_oz %>% 
  group_by(arrest_date) %>% 
  summarize(n = n()) %>% 
  summarize(avg_pday = mean(n))

ar_oz %>% 
  group_by(law_cat_cd, arrest_date) %>% 
  summarize(n = n()) %>% 
  summarize(avg_pday = mean(n))

ar_oz %>% 
  group_by(arrest_boro, arrest_date) %>% 
  summarize(n = n()) %>% 
  summarize(avg_pday = mean(n))

ar_oz %>% 
  group_by(DESIGNATED, arrest_date) %>% 
  summarize(n = n()) %>% 
  summarize(avg_pday = mean(n))

```

```{r}
#Looking at arrest type (felony, infraction, misdemeanor, violation, NA)
ar_oz %>% 
  group_by(law_cat_cd, year) %>% 
  summarize(n = n())

ar_oz %>% 
  group_by(law_cat_cd, DESIGNATED) %>% 
  summarize(n = n())

ar_oz %>% 
  filter(is.na(law_cat_cd)) %>% 
  group_by(ofns_desc) %>% 
  summarize(n = n())

ar_oz %>% 
  group_by(arrest_month_yr, law_cat_cd) %>% 
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = arrest_month_yr, y = n, color = law_cat_cd)) +
  labs(x = "Month/year", y = "Number of arrests per month", color="Arrest type") +
  theme_classic()

```

```{r}
#Looking at boro
options(scipen=10000)
ar_oz %>% 
  group_by(arrest_boro) %>% 
  summarize(n = n()) %>%
  ggplot() +
  geom_col(aes(x = arrest_boro, y = n)) +
  labs(x = "Borough", y = "Number of arrests per boro") +
  theme_classic()

ar_oz %>% 
  group_by(arrest_month_yr, arrest_boro) %>% 
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = arrest_month_yr, y = n, color = arrest_boro)) +
  labs(x = "Month/year", y = "Number of arrests per month", color="Boro") +
  theme_classic()

ar_oz %>% 
  group_by(arrest_boro, BoroPop) %>% 
  summarize(n = n()) %>% 
  mutate(boropercap = n/BoroPop) %>% 
  ggplot() +
  geom_col(aes(x = arrest_boro, y = boropercap)) +
  labs(x = "Borough", y = "Number of arrests per boro") +
  theme_classic()

```
```{r}
ar_oz %>% 
  group_by(GEOID, DESIGNATED) %>% 
  summarize(n = n()) %>%
  group_by(DESIGNATED) %>% 
  summarize(avg = mean(n))

cp_oz %>% 
  group_by(GEOID, DESIGNATED) %>% 
  summarize(n = n()) %>%
  group_by(DESIGNATED) %>% 
  summarize(avg = mean(n))

st_oz %>% 
  group_by(GEOID, DESIGNATED) %>% 
  summarize(n = n()) %>%
  group_by(DESIGNATED) %>% 
  summarize(avg = mean(n))
```


```{r}

#Looking at designated

ar_oz %>% 
  group_by(GEOID, arrest_month_yr, DESIGNATED) %>% 
  summarize(n = n()) %>%
  group_by(arrest_month_yr, DESIGNATED) %>% 
  summarize(avg = mean(n)) %>% 
  ggplot() +
  geom_line(aes(x = arrest_month_yr, y = avg, color = if_else(DESIGNATED == TRUE, 
                                                              "Selected", "Eligible"))) +
  labs(x = "Month/year", y = "Number of arrests",
       title = "Average number of arrests per month\nand by census tract",
       color="Designation Status") +
  theme_classic()

ggsave("../03_output/avg_arrests.png", height = 3, width = 4.5)

cp_oz %>% 
  group_by(GEOID, cp_month_yr, DESIGNATED) %>% 
  summarize(n = n()) %>%
  group_by(cp_month_yr, DESIGNATED) %>% 
  summarize(avg = mean(n)) %>% 
  ggplot() +
  geom_line(aes(x = cp_month_yr, y = avg, color = if_else(DESIGNATED == TRUE, 
                                                              "Selected", "Eligible"))) +
  labs(x = "Month/year", y = "Number of complaints",
       title = "Average number of complaints per month\nand by census tract",
       color="Designation Status") +
  theme_classic()

ggsave("../03_output/avg_complaints.png", height = 3, width = 4.5)

st_oz %>% 
  group_by(GEOID, st_month_yr, DESIGNATED) %>% 
  summarize(n = n()) %>%
  group_by(st_month_yr, DESIGNATED) %>% 
  summarize(avg = mean(n)) %>% 
  ggplot() +
  geom_line(aes(x = st_month_yr, y = avg, color = if_else(DESIGNATED == TRUE, 
                                                              "Selected", "Eligible"))) +
  labs(x = "Month/year", y = "Number of shootings",
       title = "Average number of shootings per month\nand by census tract",
       color="Designation Status") +
  theme_classic()

ggsave("../03_output/avg_shootings.png", height = 3, width = 4.5)

ar_oz %>% 
  filter(law_cat_cd == "F") %>% 
  group_by(arrest_month_yr, DESIGNATED) %>% 
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = arrest_month_yr, y = n, color = DESIGNATED)) +
  labs(x = "Month/year", y = "Number of felony arrests per month", color="DESIGNATED") +
  theme_classic()

ar_oz %>% 
  filter(law_cat_cd == "M") %>% 
  group_by(arrest_month_yr, DESIGNATED) %>% 
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = arrest_month_yr, y = n, color = DESIGNATED)) +
  labs(x = "Month/year", y = "Number of misdemeanor arrests per month", color="DESIGNATED") +
  theme_classic()

ar_oz %>% 
  filter(law_cat_cd == "I") %>% 
  group_by(arrest_month_yr, DESIGNATED) %>% 
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = arrest_month_yr, y = n, color = DESIGNATED)) +
  labs(x = "Month/year", y = "Number of infraction arrests per month", color="DESIGNATED") +
  theme_classic()

ar_oz %>% 
  filter(law_cat_cd == "V") %>% 
  group_by(arrest_month_yr, DESIGNATED) %>% 
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = arrest_month_yr, y = n, color = DESIGNATED)) +
  labs(x = "Month/year", y = "Number of violation arrests per month", color="DESIGNATED") +
  theme_classic()

```
``` {r}
#Breaking arrests into categories (felonies and misdemeanor). Robbery, assault, burglary, weapons, misdemeanor offenses (e.g., criminal mischief, fraud, gambling, loitering, petty theft, and larceny), other felonies (e.g., escape 3 and forgery), drugs (e.g., dangerous drugs), property (e.g., grand larceny, burglary, and burglary tools), and violent felonies (e.g., homicide, rape, robbery, arson, felony assault, and kidnapping)

ar_oz_MisFel <-ar_oz %>% filter(law_cat_cd == "M" | law_cat_cd == "F")
unique(ar_oz_MisFel$ofns_desc) 


ar_oz <- ar_oz %>%   mutate(misdemeanor = ifelse(law_cat_cd == "M", 1, 0)) %>% 
  mutate(robbery = ifelse(ofns_desc == "ROBBERY", 1, 0)) %>% 
  mutate(assault = ifelse(ofns_desc == "FELONY ASSAULT" | ofns_desc == "ASSAULT 3 & RELATED OFFENSES", 1, 0)) %>% 
  mutate(burglary = ifelse(ofns_desc == "BURGLARY", 1, 0)) %>% 
  mutate(weapons = ifelse(ofns_desc == "DANGEROUS WEAPONS", 1, 0)) %>% 
  mutate(drugs = ifelse(ofns_desc == "DANGEROUS DRUGS" | ofns_desc == "LOITERING FOR DRUG PURPOSES", 1, 0)) %>% 
  mutate(property = ifelse(ofns_desc == "GRAND LARCENY" | ofns_desc == "GRAND LARCENY OF MOTOR VEHICLE" | ofns_desc == "BURGLARY" | ofns_desc == "BURGLAR'S TOOLS", 1, 0)) %>% 
  mutate(felony_other = ifelse(law_cat_cd == "F" & robbery == 0 & assault == 0 & burglary == 0 & weapons == 0, 1, 0))
  #mutate(violent = ifelse(ofns_desc == "GRAND LARCENY" | ofns_desc == "GRAND LARCENY OF MOTOR VEHICLE" | ofns_desc == "BURGLARY" | ofns_desc == "BURGLAR'S TOOLS", 1, 0)) %>% 


ar_oz %>% 
  filter(burglary == 1) %>% 
  group_by(arrest_month_yr, DESIGNATED) %>% 
  summarize(n = n()) %>%
  ggplot() +
  geom_line(aes(x = arrest_month_yr, y = n, color = DESIGNATED)) +
  labs(x = "Month/year", y = "Number of violation arrests per month", color="DESIGNATED") +
  theme_classic()
```


